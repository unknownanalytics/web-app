!function(){"use strict";class t{constructor(t){this.config=t}_sendXHR(t){let e=new XMLHttpRequest,n=this.config;e.open(t.method,t.url,!0);let s=t.headers||{};for(let t in s)e.setRequestHeader(t,s[t]);s["Content-type"]||e.setRequestHeader("Content-Type","text/plain");let r=t.data||null;r.token||(r.token=n.token),"string"!=typeof r&&(r=JSON.stringify(r)),e.onreadystatechange=function(){if(4===e.readyState)try{let n=JSON.parse(e.responseText);200===e.status&&"OK"===n.status?(t.onSuccess&&t.onSuccess(n),console.log("successful")):(t.onError&&t.onError(n),console.error("failed to execute "))}catch(t){console.log(e.status)}},e.send(r||null)}_sendRequest(t){console.log(t),(t=t||{}).method||(t.method="GET"),t.sync?this._sendXHR(t):setTimeout(()=>{this._sendXHR(t)})}push(t){(t=t||{}).method="POST",t.url=this.config.apiURL,this._sendRequest(t)}}const e={parse(t){function e(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}}let n=/(\w+)\[(\d+)\]/;if("string"!=typeof t)return{};if(""===(t=t.trim()))return{};"?"===t.charAt(0)&&(t=t.slice(1));let s={},r=t.split("&");for(let t=0;t<r.length;t++){let o,i=r[t].split("="),a=e(i[0]);(o=n.exec(a))?(s[o[1]]=s[o[1]]||[],s[o[1]][o[2]]=e(i[1])):s[i[0]]=null==i[1]?"":e(i[1])}return s},utm(t){let n;"?"===t.charAt(0)&&(t=t.substring(1)),t=t.replace(/\?/g,"&");let s=e.parse(t),r={};for(let t in s)Object.hasOwnProperty.call(s,t)&&"utm_"===t.substr(0,4)&&("campaign"===(n=t.substr(4))&&(n="name"),r[n]=s[t]);return r},getBrowserParams:()=>({ua:navigator.userAgent,ww:window.innerWidth,wh:window.innerHeight}),getArraySize:t=>JSON.stringify(t).replace(/[\[\]\,\"]/g,"").length},n="view";class s{constructor(t,e){this.options=t,this.sender=e;var n,s;n=window.history,s=n.pushState,n.pushState=function(t){"function"==typeof n.onpushstate&&n.onpushstate({state:t});var e=new Event("pushState");return e.arguments=arguments,window.dispatchEvent(e),s.apply(n,arguments)},window.addEventListener("pushState",this.handleUrl.bind(this)),this.fireFirstEvent()}fireFirstEvent(){this.handleUrl()}handleUrl(t){let n=document.location,s=n.href;if("localhost"!==n.hostname&&!n.origin.startsWith("https"))return console.error("only https is allowed");let r=Object.assign({},{full_url:s},{utm:e.utm(s)});this.push(r)}push(t){t=Object.assign({},t,{browser:e.getBrowserParams()}),this.sender.push({data:t,type:n})}}let r={apiURL:"https://www.unknownanalytics.com/collect",version:"beta",wsURL:"PUSH_URL",token:null};window.unkAnalytics=function(e,n){r.token=e;let o=new t(r);new s(n,o)},window.unkAnalytics.version=r.version}();
