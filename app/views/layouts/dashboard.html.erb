<% content_for :custom_css_assets do %>
  <%= stylesheet_link_tag 'dashboard', media: 'all', 'data-turbolinks-track': 'reload' %>

<% end %>

<% content_for :custom_js_assets do %>
  <%= javascript_include_tag 'dashboard', 'data-turbolinks-track': 'reload' %>

<% end %>

<%= extends :application do %>

  <%= render "includes/header" %>

  <div class="container">
    <div class="section">
      <div class="columns">
        <aside class="column is-2">
          <%= render "includes/menu" %>
        </aside>
        <div class="column is-10">
          <div class="is-12 main-container">
            <% if current_domain.nil? %>

              <span class="title">Select or create a domain</span>
              <!-- TODO -->
              <% if @my_domains.size > 0 %>
                <%= form_tag('/dashboard/set-current-domain') do %>
                  <div class="field">
                    <div class="control">
                      <div class="select">
                        <%= select_tag(:domain_id, options_from_collection_for_select(@my_domains, 'id', 'name', current_domain.nil? ? nil : current_domain.id), {include_blank: t('None')}) %>
                      </div>
                    </div>
                  </div>
                  <%= submit_tag t('Select', class: 'button is-link') %>
                <% end -%>
              <% end -%>
              <div>
                <%= link_to(dashboard_domains_path, nil, {class: 'is-link'}) do %>
                  <span><%= t('domain.create') %></span>
                <% end %>
              </div>
            <% end %>



            <%= yield %>

          </div>
          <% cache('dashboard/vue-templates/index') do %>
            <%= render 'dashboard/vue-templates/index' %>
          <% end %>


        </div>
      </div>
    </div>
    <%= render "includes/footer_logged_in" %>

  </div>
  <!-- TODO, serve this from our cdn -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/underscore@1.9.1/underscore.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>
  <% if current_domain.present? %>
    <script>
        //  window.addEventListener('load', function () {
        document.addEventListener("turbolinks:load", function (event) {
            let path = (new URL(event.data.url)).pathname;
            if (App.Routes[path]) {
                App.Routes[path]();
            }
        })
    </script>
  <% end %>

<% end %>
