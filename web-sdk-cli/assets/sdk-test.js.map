{"version":3,"file":"sdk-test.js","sources":["../src/utils.js","../src/plugins/view-manager.js","../src/main.js"],"sourcesContent":["/**\n *\n */\nclass Sender {\n    /*\n    wsInstance: WebSocket = null;\n    config: {} = null;*/\n\n    constructor(config) {\n        this.config = config;\n        this.debug = config.debug;\n        // WS is not supported\n        /*if (!this.wsInstance) {\n                this.wsInstance = this._initWS();\n        }*/\n    }\n\n    /*\n        /!**\n         *\n         * @returns {null|WebSocket}\n         *!/\n        _initWS() {\n            if (\"WebSocket\" in window) {\n                // Let us open a web socket\n                let ws = new WebSocket(config.pushURL);\n\n                ws.onopen = () => {\n                    console.log(\"cnx\");\n                };\n\n                ws.onmessage = (evt) => {\n                    console.log(\"Message received\");\n                };\n                ws.onclose = () => {\n                    console.log(\"cnx closed\");\n                };\n                ws.onerror = () => {\n                    console.log(\"onerror\");\n                };\n                return ws;\n            } else {\n                // The browser doesn't support WebSocket\n                console.warn(\"WebSocket NOT supported by your Browser!\");\n                return null;\n            }\n        }*/\n\n    /**\n     * @param args {XHRArgs}\n     * @private\n     */\n    _sendXHR(args) {\n        let xhr = new XMLHttpRequest();\n        let config = this.config;\n        // : 'bearer ' + config.token\n        xhr.open(args.method, args.url, true);\n        let headers = args.headers || {};\n        for (let key in headers) {\n            xhr.setRequestHeader(key, headers[key]);\n        }\n        // Avoid the preflight request\n        //xhr.setRequestHeader('Authorization', config.token);\n        if (!headers['Content-type']) {\n            xhr.setRequestHeader(\"Content-Type\", \"text/plain\");\n        }\n        let data = args.data || null;\n        if (!data.token) {\n            data.token = config.token;\n        }\n        if (typeof (data) !== \"string\") {\n            data = JSON.stringify(data);\n        }\n        // catch the callback\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {\n                try {\n                    let response = JSON.parse(xhr.responseText);\n                    if (xhr.status === 200 && response.status === 'OK') {\n                        args.onSuccess && args.onSuccess(response);\n                    } else {\n                        args.onError && args.onError(response);\n                    }\n                } catch (e) {\n                    console.log(xhr.status)\n                }\n            }\n        };\n        xhr.send(data || null);\n    }\n\n    /**\n     *\n     * @param args\n     */\n    _sendRequest(args) {\n        console.log(args);\n        args = args || {};\n        if (!args.method) {\n            args.method = 'GET';\n        }\n        // check if is async mode\n        if (args.sync) {\n            this._sendXHR(args);\n        } else {\n            // do not block the app\n            setTimeout(() => {\n                this._sendXHR(args);\n            })\n        }\n    }\n\n    /**\n     *\n     * @param args\n     * @returns {boolean}\n     */\n    push(args) {\n        /*// WS not supported yet\n        if (this.wsInstance) {\n            let data = args.data;\n            data.endpoint = endpoint;\n            data = JSON.stringify(args.data);\n            this.wsInstance.send(data);\n            return true;\n        }*/\n        args = args || {};\n        args.method = 'POST';\n        args.url = this.config.apiURL;\n        if (this.debug) {\n            return console.log(\"unk\", args);\n        }\n        this._sendRequest(args);\n    }\n}\n\n/**\n *\n * @type {{getBrowserParams(): *, sendXHR(*=): void, _sendXHR(*): void, parse(String): (*|*|*), postXHR(*=): void, utm(*=): *}}\n */\nconst Utils = {\n    /**\n     * Parse the given query `str`.\n     *\n     * @param {String} str\n     * @return {Object}\n     * @api public\n     */\n    parse(str) {\n        function decode(str) {\n            try {\n                return decodeURIComponent(str.replace(/\\+/g, ' '));\n            } catch (e) {\n                return str;\n            }\n        }\n\n        let pattern = /(\\w+)\\[(\\d+)\\]/;\n        if ('string' != typeof str) return {};\n        str = str.trim();\n        if ('' === str) return {};\n        if ('?' === str.charAt(0)) str = str.slice(1);\n\n        let obj = {};\n        let pairs = str.split('&');\n        for (let i = 0; i < pairs.length; i++) {\n            let parts = pairs[i].split('=');\n            let key = decode(parts[0]);\n            let m;\n            if (m = pattern.exec(key)) {\n                obj[m[1]] = obj[m[1]] || [];\n                obj[m[1]][m[2]] = decode(parts[1]);\n                continue;\n            }\n\n            obj[parts[0]] = null == parts[1]\n                ? ''\n                : decode(parts[1]);\n        }\n        return obj;\n    },\n    /**\n     * Utm parsing\n     * @param query\n     */\n    utm(query) {\n        // Remove leading ? if present\n        if (query.charAt(0) === '?') {\n            query = query.substring(1);\n        }\n        query = query.replace(/\\?/g, '&');\n        let param;\n        let params = Utils.parse(query);\n        let results = {};\n        for (let key in params) {\n            if (Object.hasOwnProperty.call(params, key)) {\n                if (key.substr(0, 4) === 'utm_') {\n                    param = key.substr(4);\n                    if (param === 'campaign') param = 'name';\n                    results[param] = params[key];\n                }\n            }\n        }\n        return results;\n    },\n    /**\n     * @returns {BrowserParams}\n     *  The browser information\n     */\n    getBrowserParams() {\n        return {\n            // user agent\n            ua: navigator.userAgent,\n            // window width\n            ww: window.innerWidth,\n            // window height\n            wh: window.innerHeight\n        }\n    },\n    /**\n     * Get array approximately the size of array\n     */\n    getArraySize(array) {\n        return (JSON.stringify(array).replace(/[\\[\\]\\,\\\"]/g, '')).length;\n    },\n};\n\nexport {Sender, Utils};\n","import {Utils} from \"../utils\";\n\nconst VIEW = 'view';\n\n/**\n *\n */\nclass PageViewManager {\n    /*\n    sender: Sender = null;\n    options: null;\n    */\n    // instance singleton\n    static manager = null;\n\n    /**\n     *\n     * @param options\n     * @param sender\n     */\n    /**\n     *\n     * @param options\n     * @param sender\n     */\n    constructor(options, sender) {\n        console.log('######## Create new instance ##############\"');\n        this.options = options;\n        this.sender = sender;\n        this.lastLocation = null;\n        // override default function and add custom event change\n        var eventName = 'unkChange';\n        window.addEventListener(eventName, this.onPopChange.bind(this));\n        /* override pushState */\n        history.pushState = (f => function pushState() {\n            var ret = f.apply(this, arguments);\n            window.dispatchEvent(new Event('pushstate'));\n            window.dispatchEvent(new Event(eventName));\n            return ret;\n        })(history.pushState);\n        /* override replaceState */\n        history.replaceState = (f => function replaceState() {\n            var ret = f.apply(this, arguments);\n            window.dispatchEvent(new Event('replacestate'));\n            window.dispatchEvent(new Event(eventName));\n            return ret;\n        })(history.replaceState);\n        /* Add event listener */\n        window.addEventListener('popstate', () => {\n            window.dispatchEvent(new Event(eventName))\n        })\n        // init first call\n        this.onPopChange();\n    }\n\n    /**\n     *\n     */\n    onPopChange(event) {\n        // console.log('######## onPopChange event##############\"');\n        let location = document.location;\n        if (this.lastLocation !== location.href) {\n            let href = location.href;\n            if (!(location.hostname === 'localhost' || location.hostname === '127.0.0.1' || location.origin.startsWith('https'))) {\n                return console.error('only https is allowed');\n            }\n            let data = Object.assign({}, {url: href}, {utm: Utils.utm(href)});\n            this.push(data);\n        }\n        this.lastLocation = location.href;\n    }\n\n    static createManager(options, sender) {\n        if (!PageViewManager.manager) {\n            PageViewManager.manager = new PageViewManager(options, sender);\n        }\n        return PageViewManager.manager;\n    }\n\n    /**\n     *\n     */\n    push(body) {\n        body = Object.assign({}, body, {browser: Utils.getBrowserParams()});\n        this.sender.push({data: body, type: VIEW})\n    }\n}\n\nexport default PageViewManager;\n","/**\n *\n */\nimport PageViewManager from './plugins/view-manager';\n//import EventManager from './plugins/event-manger';\n//import ErrorManager from './plugins/error-manger';\nimport {Sender} from './utils' ;\n\n\n/**\n *\n * @type {{agent: string, ui: {w: number, h: number}}}\n */\nlet config = {\n    apiURL: 'SDK_API_HOST',\n    version: 'SDK_VERSION',\n    wsURL: 'PUSH_URL',\n    token: null\n};\n/**\n *\n * @param token\n * @param options\n */\nwindow.unkAnalytics = function (token, options) {\n    config.token = token;\n    config.debug = options.debug;\n    let sender = new Sender(config, options);\n    PageViewManager.createManager(options, sender);\n    //new EventManager(options, sender);\n    //new ErrorManager(options, sender);\n};\nwindow.unkAnalytics.version = config.version;\n"],"names":["Sender","constructor","config","debug","_sendXHR","args","xhr","XMLHttpRequest","open","method","url","headers","key","setRequestHeader","data","token","JSON","stringify","onreadystatechange","readyState","response","parse","responseText","status","onSuccess","onError","e","console","log","send","_sendRequest","sync","setTimeout","push","apiURL","Utils","str","decode","decodeURIComponent","replace","pattern","trim","charAt","slice","obj","pairs","split","i","length","parts","m","exec","utm","query","substring","param","params","results","Object","hasOwnProperty","call","substr","getBrowserParams","ua","navigator","userAgent","ww","window","innerWidth","wh","innerHeight","getArraySize","array","VIEW","PageViewManager","options","sender","lastLocation","eventName","addEventListener","onPopChange","bind","history","pushState","f","ret","apply","arguments","dispatchEvent","Event","replaceState","event","location","document","href","hostname","origin","startsWith","error","assign","createManager","manager","body","browser","type","version","wsURL","unkAnalytics"],"mappings":"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"}